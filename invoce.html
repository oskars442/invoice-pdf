<!DOCTYPE html>
<html lang="lv">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  
  <title>Invoice Editor</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .invoice-card, .section-box {
      background: #fff;
      border: 1px solid #e0e0e0;
      border-radius: .75rem;
      padding: 1rem;
    }
    .invoice-card {
      background: #f0f0f0;
      cursor: pointer;
    }
    .invoice-card .label, .section-title h5 {
      font-size: .9rem;
      color: #333;
    }
    .invoice-card .value {
      font-size: 1.2rem;
      font-weight: 600;
    }
    .invoice-card small, .section-box small {
      color: #666;
    }
    .section-title {
      position: relative;
      margin-bottom: .5rem;
    }
    .section-title h5 {
      display: inline-block;
      margin: 0;
      padding-bottom: .25rem;
      color: #333;
    }
    .section-title::after {
      content: "";
      position: absolute;
      bottom: 0;
      left: 0;
      width: 80px;
      height: 4px;
      background: #ff00aa;
      border-radius: 2px;
    }
    .clickable {
      cursor: pointer;
    }
    .bg-pink {
      background-color: #ff00aa !important;
    }
    .discount-col .btn.dropdown-toggle::after {
      border-top-color: rgba(0,0,0,0.5) !important;
    }
  </style>
</head>
<body class="p-5">


  <div id="invoiceContainer">
  <div class="row">
  <!-- Invoice card: full width on xs/sm, half on md+ -->
  <div class="col-12 col-md-6 mb-3">
    <div class="invoice-card w-100" data-bs-toggle="modal" data-bs-target="#headerModal">
      <div class="d-flex justify-content-between align-items-start">
        <div>
          <div id="cardLabel" class="label">RÄ“Ä·ina numurs</div>
          <div id="cardInvNum" class="value">INV-2025/3</div>
        </div>
        <button class="btn btn-sm btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#headerModal">âœ</button>
      </div>
      <div class="mt-2">
        <small>RÄ“Ä·ina datums</small> <span id="cardIssue">02.07.2025</span><br>
        <small>ApmaksÄt lÄ«dz</small> <span id="cardDue">16.07.2025</span><br>
        <small>KavÄ“juma nauda</small> <span id="cardInterest">â€“</span>
      </div>
    </div>
  </div>

  <!-- Final checkbox -->
  <div class="form-check mb-4">
    <input class="form-check-input" type="checkbox" id="finalCheckbox">
    <label class="form-check-label" for="finalCheckbox">AtzÄ«mÄ“t kÄ gala rÄ“Ä·inu</label>
  </div>

  <!-- Supplier & Recipient -->
  <div class="row mb-4">
    <div class="col-md-6">
      <div class="clickable" data-bs-toggle="modal" data-bs-target="#supplierModal">
        <div class="section-title"><h5>PiegÄdÄtÄjs</h5></div>
        <div class="section-box mb-3">
          <p class="mb-1"><strong id="supName">Augusts Oskars SekliÅ†Å¡</strong></p>
          <small id="supReg">161297-11759</small><br>
          <small id="supAddr">Mirdzas Ä¶empes iela 28/23</small>
        </div>
        <div class="section-box mb-3">
          <p class="mb-0"><small>IBAN</small> <strong id="supIban">LV05UNLA0050021760189</strong></p>
          <small id="supBank">SEB</small>
          <span class="float-end"><small id="supCode">UNLALV2X</small></span>
        </div>
        <div class="section-box mb-3">
          <p class="mb-1"><small>Email</small> <span id="supEmail">oskars443@inbox.lv</span></p>
          <p class="mb-0"><small>Tel.</small> <span id="supPhone">+371 24932463</span></p>
        </div>
        <div class="section-box">
          <p id="supNotes" class="mb-0 small">Pievienot piezÄ«mes</p>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="clickable" data-bs-toggle="modal" data-bs-target="#recipientModal">
        <div class="section-title"><h5>SaÅ†Ä“mÄ“js</h5></div>
        <div class="section-box mb-3">
          <p class="mb-1"><strong id="recName">EUROKONT, IK</strong></p>
          <small id="recReg">50002172701</small><br>
          <small id="recVat">PVN reÄ£istrÄcijas numurs</small><br>
          <small id="recAddr">RÄ«ga, Neretas iela 2 â€“ 9, LV-1004</small>
        </div>
        <div class="section-box mb-3">
          <p class="mb-0"><small>IBAN</small> <strong id="recIban">LV12BANK000123456789</strong></p>
          <small id="recBank">Swedbank</small>
          <span class="float-end"><small id="recCode">SWEDLV2X</small></span>
        </div>
        <div class="section-box mb-3">
          <p class="mb-1"><small>Email</small> <span id="recEmail">aaa@email.com</span></p>
          <p class="mb-0"><small>Tel.</small> <span id="recPhone">+371 2222222</span></p>
        </div>
        <div class="section-box" id="recNotes">Pievienot piezÄ«mes</div>
      </div>
    </div>
  </div>

  <!-- PRODUCTS -->
  <div id="productsContainer" class="mb-4">
    <div class="d-flex justify-content-between align-items-center section-title mb-2">
      <h5>Produkta/Pakalpojuma detaÄ¼as</h5>
      <div class="form-check">
        <input class="form-check-input" type="checkbox" id="toggleDiscountColumn">
        <label class="form-check-label" for="toggleDiscountColumn">Atlaide</label>
      </div>
    </div>

    <div id="productsHeader" class="d-flex bg-pink text-white rounded-top px-3 py-2">
      <div class="flex-fill">Nosaukums</div>
      <div class="flex-shrink-1" style="width:100px;">MÄ“rv.</div>
      <div class="flex-shrink-1 text-center" style="width:80px;">Daudz.</div>
      <div class="flex-shrink-1 text-end" style="width:100px;">Cena</div>
      <div class="flex-shrink-1 text-center discount-col" style="width:100px; display:none;">Atlaide</div>
      <div class="flex-shrink-1 text-end" style="width:100px;">KopÄ EUR</div>
    </div>

    <!-- ONE product row + desc -->
    <div class="d-flex border border-top-0 px-3 py-2 align-items-center product-row">
      <input type="text" class="form-control me-3" placeholder="Nosaukumsâ€¦">
      <select class="form-select me-3" style="width:100px;">
        <option>gab</option><option>m</option><option>h</option>
      </select>
      <input type="number" class="form-control me-3 text-center" style="width:80px;" value="1">
      <input type="number" class="form-control me-3 text-end" style="width:100px;" step="0.01" value="0.00">

      <!-- Discount cell -->
      <div class="text-center me-3 discount-col" style="width:100px; display:none;">
        <div class="input-group input-group-sm">
          <input type="text" class="form-control text-center" placeholder="0%">
          <button class="btn btn-outline-light dropdown-toggle" type="button" data-bs-toggle="dropdown"></button>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="#">0%</a></li>
            <li><a class="dropdown-item" href="#">5%</a></li>
            <li><a class="dropdown-item" href="#">10%</a></li>
            <li><a class="dropdown-item" href="#">20%</a></li>
            <li><a class="dropdown-item" href="#">25%</a></li>
            <li><a class="dropdown-item" href="#">50%</a></li>
          </ul>
        </div>
      </div>

      <div class="text-end" style="width:100px;">â‚¬ 0.00</div>
    </div>
    <div class="d-flex border border-top-0 rounded-bottom px-3 py-2 align-items-center">
      <input type="text" class="form-control form-control-sm text-muted me-2 flex-grow-1" placeholder="Äªss apraksts par Å¡o rinduâ€¦">
      <button type="button" class="btn btn-outline-danger btn-sm delete-row-btn" title="Delete">ğŸ—‘</button>
    </div>
  </div>

  <!-- Add-row button -->
  <div class="d-flex justify-content-center align-items-center my-4">
    <button id="addRowBtn" class="btn btn-light rounded-circle shadow me-3" style="width:48px;height:48px;font-size:1.5rem;line-height:1;">+</button>
    <span class="h6 mb-0">Pievienot jaunu rindu</span>
  </div>

  <!-- Header Modal -->
  <div class="modal fade" id="headerModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered"><div class="modal-content p-3">
      <div class="modal-header border-0">
        <h5 class="modal-title">RÄ“Ä·ina numurs un datums</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div class="mb-3"><label class="form-label">KÄrtas numurs</label>
          <input type="number" id="inputNumber" class="form-control" value="3"></div>
        <div class="mb-3"><label class="form-label">FormÄts</label>
          <input type="text" id="inputFormat" class="form-control" value="INV-{Y}/{N}"></div>
        <div class="mb-3"><label class="form-label">RÄ“Ä·ina datums</label>
          <input type="date" id="inputIssue" class="form-control" value="2025-07-02"></div>
        <div class="mb-3"><label class="form-label">ApmaksÄt lÄ«dz</label>
          <input type="date" id="inputDue" class="form-control" value="2025-07-16"></div>
        <div class="mb-3"><label class="form-label">KavÄ“juma nauda</label>
          <select id="inputInterest" class="form-select">
            <option value="">â€“</option>
            <option value="0.5%">0.5% dienÄ</option>
            <option value="1%">1% dienÄ</option>
          </select></div>
      </div>
      <div class="modal-footer border-0">
        <button class="btn btn-success w-100" id="saveHeaderBtn" data-bs-dismiss="modal">SaglabÄt</button>
      </div>
    </div></div>
  </div>

  <!-- Supplier Modal -->
  <div class="modal fade" id="supplierModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered"><div class="modal-content p-3">
      <div class="modal-header border-0">
        <h5 class="modal-title">RediÄ£Ä“t PiegÄdÄtÄju</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div class="mb-3"><label class="form-label">Nosaukums</label>
          <input type="text" id="inputSupName" class="form-control" value="Augusts Oskars SekliÅ†Å¡"></div>
        <div class="mb-3"><label class="form-label">ReÄ£.Nr.</label>
          <input type="text" id="inputSupReg" class="form-control" value="161297-11759"></div>
        <div class="mb-3"><label class="form-label">Adrese</label>
          <input type="text" id="inputSupAddr" class="form-control" value="Mirdzas Ä¶empes iela 28/23"></div>
        <div class="mb-3"><label class="form-label">IBAN</label>
          <input type="text" id="inputSupIban" class="form-control" value="LV05UNLA0050021760189"></div>
        <div class="mb-3"><label class="form-label">Banka</label>
          <input type="text" id="inputSupBank" class="form-control" value="SEB"></div>
        <div class="mb-3"><label class="form-label">SWIFT/Kods</label>
          <input type="text" id="inputSupCode" class="form-control" value="UNLALV2X"></div>
        <div class="mb-3"><label class="form-label">Email</label>
          <input type="email" id="inputSupEmail" class="form-control" value="oskars443@inbox.lv"></div>
        <div class="mb-3"><label class="form-label">Telefons</label>
          <input type="text" id="inputSupPhone" class="form-control" value="+371 24932463"></div>
        <div class="mb-3"><label class="form-label">PiezÄ«mes</label>
          <textarea id="inputSupNotes" class="form-control" rows="3" placeholder="Pievienot piezÄ«mesâ€¦"></textarea></div>
      </div>
      <div class="modal-footer border-0">
        <button class="btn btn-success w-100" id="saveSupBtn" data-bs-dismiss="modal">SaglabÄt</button>
      </div>
    </div></div>
  </div>

  <!-- Recipient Modal -->
  <div class="modal fade" id="recipientModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered"><div class="modal-content p-3">
      <div class="modal-header border-0">
        <h5 class="modal-title">RediÄ£Ä“t SaÅ†Ä“mÄ“ju</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div class="mb-3"><label class="form-label">Nosaukums</label>
          <input type="text" id="inputRecName" class="form-control" value="EUROKONT, IK"></div>
        <div class="mb-3"><label class="form-label">ReÄ£.Nr.</label>
          <input type="text" id="inputRecReg" class="form-control" value="50002172701"></div>
        <div class="mb-3"><label class="form-label">PVN Nr.</label>
          <input type="text" id="inputRecVat" class="form-control" value="PVN reÄ£istrÄcijas numurs"></div>
        <div class="mb-3"><label class="form-label">Adrese</label>
          <input type="text" id="inputRecAddr" class="form-control" value="RÄ«ga, Neretas iela 2 â€“ 9, LV-1004"></div>
        <div class="mb-3"><label class="form-label">IBAN</label>
          <input type="text" id="inputRecIban" class="form-control" value="LV12BANK000123456789"></div>
        <div class="mb-3"><label class="form-label">Banka</label>
          <input type="text" id="inputRecBank" class="form-control" value="Swedbank"></div>
        <div class="mb-3"><label class="form-label">SWIFT/Kods</label>
          <input type="text" id="inputRecCode" class="form-control" value="SWEDLV2X"></div>
        <div class="mb-3"><label class="form-label">Email</label>
          <input type="email" id="inputRecEmail" class="form-control" value="aaa@email.com"></div>
        <div class="mb-3"><label class="form-label">Telefons</label>
          <input type="text" id="inputRecPhone" class="form-control" value="+371 2222222"></div>
        <div class="mb-3"><label class="form-label">PiezÄ«mes</label>
          <textarea id="inputRecNotes" class="form-control" rows="3" placeholder="Pievienot piezÄ«mesâ€¦"></textarea></div>
      </div>
      <div class="modal-footer border-0">
        <button class="btn btn-success w-100" id="saveRecBtn" data-bs-dismiss="modal">SaglabÄt</button>
      </div>
    </div></div>
  </div>
  <!-- PAYMENT & TRANSACTION TYPES -->
<div class="row g-4 mb-4">
  <div class="col-md-6">
    <!-- Apmaksas veids -->
    <div class="section-title"><h5>Apmaksas veids</h5></div>
    <div class="section-box mb-3">
      <select id="paymentType" class="form-select">
        <option value="pÄrskaite">PÄrskaitÄ«jums</option>
        <option value="skaidra">Skaidra nauda</option>
        <option value="kreditkarte">Kreditkarte</option>
        <option value="cits">Cits</option>
      </select>
    </div>
    <!-- Hidden custom field -->
    <div class="section-box mb-3" id="paymentTypeCustom" style="display: none;">
      <input type="text" class="form-control" placeholder="Cits apmaksas veids" />
    </div>

    <!-- DarÄ«juma veids -->
    <div class="section-title"><h5>DarÄ«juma veids</h5></div>
    <div class="section-box mb-3">
      <select id="transactionType" class="form-select">
        <option value="precu-pardosana">PreÄu pÄrdoÅ¡ana</option>
        <option value="precu-piegade">PreÄu piegÄde</option>
        <option value="pakalpojums">Pakalpojums</option>
        <option value="cits">Cits</option>
      </select>
    </div>
    <!-- Hidden custom field -->
    <div class="section-box mb-3" id="transactionTypeCustom" style="display: none;">
      <input type="text" class="form-control" placeholder="Cits darÄ«juma veids" />
    </div>
  </div>

  <!-- right half: your total -->
  <div class="col-12 col-md-6">
  <div class="d-flex justify-content-end align-items-baseline">
    <div class="me-3 text-end">
      <small class="d-block">KopÄ apmaksai</small>
      <!-- add id here -->
        <span id="grandTotal" class="fs-4 fw-bold">â‚¬ 0.00</span>
    </div>
  </div>
  <div id="grandTotalWords" class="text-end small text-muted">
    nulle euro un 0 centi
  </div>
</div>

<div class="text-center mt-5 d-flex justify-content-center gap-3">
  <button id="saveInvoiceBtn" class="btn btn-primary btn-lg">ğŸ’¾ SaglabÄt rÄ“Ä·inu</button>
  <!-- <button onclick="downloadPDF()" class="btn btn-outline-dark btn-lg">â¬‡ï¸ SaglabÄt kÄ PDF</button> -->
</div>
</div>



  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
 <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>
  <script>
  // Final toggle
  document.getElementById('finalCheckbox').addEventListener('change', e => {
    document.getElementById('cardLabel').textContent =
      e.target.checked ? 'Gala rÄ“Ä·ina numurs' : 'RÄ“Ä·ina numurs';
  });

  // Header save
  document.getElementById('saveHeaderBtn').addEventListener('click', () => {
    const seq   = document.getElementById('inputNumber').value;
    const fmt   = document.getElementById('inputFormat').value;
    const issue = document.getElementById('inputIssue').value;
    const due   = document.getElementById('inputDue').value;
    const intr  = document.getElementById('inputInterest').value;
    const year  = new Date(issue).getFullYear();
    document.getElementById('cardInvNum').textContent =
      fmt.replace('{Y}', year).replace('{N}', seq);
    const fmtDate = d => new Date(d)
      .toLocaleDateString('lv-LV',{day:'2-digit',month:'2-digit',year:'numeric'});
    document.getElementById('cardIssue').textContent = fmtDate(issue);
    document.getElementById('cardDue').textContent   = fmtDate(due);
    document.getElementById('cardInterest').textContent =
      intr ? intr + ' dienÄ' : 'â€“';
  });

  // Supplier save
  document.getElementById('saveSupBtn').onclick = () => {
    ['Name','Reg','Addr','Iban','Bank','Code','Email','Phone'].forEach(id => {
      document.getElementById('sup'+id).textContent =
        document.getElementById('inputSup'+id).value;
    });
    const notes = document.getElementById('inputSupNotes').value.trim();
    document.getElementById('supNotes').textContent =
      notes || 'Pievienot piezÄ«mes';
  };

  // Recipient save
  document.getElementById('saveRecBtn').onclick = () => {
    ['Name','Reg','Vat','Addr','Iban','Bank','Code','Email','Phone','Notes']
      .forEach(id => {
        document.getElementById('rec'+id).textContent =
          document.getElementById('inputRec'+id).value;
      });
  };

  // Discount toggle
  const toggle = document.getElementById('toggleDiscountColumn');
  toggle.addEventListener('change', () => {
    document.querySelectorAll('.discount-col')
      .forEach(el => el.style.display = toggle.checked ? '' : 'none');
    document.querySelectorAll('.product-row')
      .forEach(r => r.dispatchEvent(new Event('recalc')));
  });

  // Dropdown presets for discount
  document.querySelectorAll('.discount-col .dropdown-item')
    .forEach(el => el.addEventListener('click', e => {
      e.preventDefault();
      const inp = e.target.closest('.input-group').querySelector('input');
      inp.value = e.target.textContent;
      inp.dispatchEvent(new Event('input'));
    }));

  // Recompute grand total
  function updateGrandTotal() {
    const rows = document.querySelectorAll('#productsContainer .product-row');
    let sum = 0;
    rows.forEach(r => {
      const txt = r.querySelector('.text-end:last-child').textContent;
      // strip non-digits, convert commaâ†’dot, parseFloat
      const num = parseFloat(txt.replace(/[^\d,]/g,'').replace(',','.')) || 0;
      sum += num;
    });
    const formatted = new Intl.NumberFormat('lv-LV',{
      style:'currency',currency:'EUR'
    }).format(sum);
    document.getElementById('grandTotal').textContent = formatted;
    // optional words below
    document.getElementById('grandTotalWords').textContent =
      sum === 0
        ? 'nulle euro un 0 centi'
        : formatted + ' kopÄ';
  }

  // Wire recalc on each product-row
  function wireRecalc(row) {
    const [qty, price] = row.querySelectorAll('input[type="number"]');
    const disc = row.querySelector('.discount-col input');
    const totCell = row.querySelector('.text-end:last-child');

    function recalc() {
      let q = parseFloat(qty.value)||0,
          p = parseFloat(price.value.replace(',','.'))||0,
          t = q * p;
      if (disc && disc.offsetParent && disc.value.trim()) {
        let pct = parseFloat(disc.value.replace('%',''))||0;
        t *= (1 - pct/100);
      }
      totCell.textContent = new Intl.NumberFormat('lv-LV',{
        style:'currency',currency:'EUR'
      }).format(t);
    }

    function recalcAll() {
      recalc();
      updateGrandTotal();
    }

    [qty, price, disc].filter(Boolean)
      .forEach(el => el.addEventListener('input', recalcAll));
    row.addEventListener('recalc', recalcAll);

    // initial calc
    recalcAll();
  }

  // Wire delete on description row
  function wireDelete(descRow) {
    const btn = descRow.querySelector('.delete-row-btn');
    if (!btn) return;
    btn.addEventListener('click', () => {
      const prodRow = descRow.previousElementSibling;
      if (prodRow && prodRow.classList.contains('product-row'))
        prodRow.remove();
      descRow.remove();
      updateGrandTotal();
    });
  }

  // Init existing rows
  document.querySelectorAll('.product-row').forEach(wireRecalc);
  document.querySelectorAll('#productsContainer > .border.rounded-bottom')
    .forEach(wireDelete);

  // Prepare template for add-row
  const tpl = document.createElement('div');
  const r0 = document.querySelector('.product-row');
  tpl.append(r0.cloneNode(true), r0.nextElementSibling.cloneNode(true));

  // Add-row handler
  document.getElementById('addRowBtn').addEventListener('click', () => {
    const newR = tpl.children[0].cloneNode(true),
          newD = tpl.children[1].cloneNode(true);

    newR.querySelectorAll('input,select').forEach(el => {
      if (el.tagName === 'INPUT') {
        if (el.type==='number' || el.type==='text') el.value = '';
        if (el.type==='checkbox') el.checked = false;
      } else {
        el.selectedIndex = 0;
      }
    });
    const showDisc = toggle.checked;
    newR.querySelectorAll('.discount-col')
      .forEach(c => c.style.display = showDisc ? '' : 'none');

    const cont = document.getElementById('productsContainer');
    cont.append(newR, newD);

    // re-wire discount dropdowns
    newR.querySelectorAll('.discount-col .dropdown-item').forEach(el => {
      el.addEventListener('click', e => {
        e.preventDefault();
        const inp = e.target.closest('.input-group').querySelector('input');
        inp.value = e.target.textContent;
        inp.dispatchEvent(new Event('input'));
      });
    });

    wireRecalc(newR);
    wireDelete(newD);
    updateGrandTotal();
  });

  // â€œCitsâ€ custom-field toggles
  function toggleCustom(selectId, customDivId) {
    const sel    = document.getElementById(selectId);
    const custom = document.getElementById(customDivId);
    sel.addEventListener('change', () => {
      custom.style.display = sel.value==='cits' ? '' : 'none';
    });
    // initial
    custom.style.display = sel.value==='cits' ? '' : 'none';
  }
  toggleCustom('paymentType',     'paymentTypeCustom');
  toggleCustom('transactionType', 'transactionTypeCustom');

  // initial grand-total
  updateGrandTotal();



  document.getElementById('saveInvoiceBtn').addEventListener('click', () => {
    // Send message to parent (Wix site)
    window.parent.postMessage({ action: 'redirectToInvoice' }, '*');
  });

document.getElementById('saveInvoiceBtn').addEventListener('click', () => {
    const invoiceData = {
      invoiceNumber: document.getElementById('cardInvNum').textContent,
      invoiceDate: document.getElementById('cardIssue').textContent,
      dueDate: document.getElementById('cardDue').textContent,
      interest: document.getElementById('cardInterest').textContent,
      final: document.getElementById('finalCheckbox').checked,
      supplier: {
        name: document.getElementById('supName').textContent,
        reg: document.getElementById('supReg').textContent,
        addr: document.getElementById('supAddr').textContent,
        iban: document.getElementById('supIban').textContent,
        bank: document.getElementById('supBank').textContent,
        code: document.getElementById('supCode').textContent,
        email: document.getElementById('supEmail').textContent,
        phone: document.getElementById('supPhone').textContent,
        notes: document.getElementById('supNotes').textContent,
      },
      recipient: {
        name: document.getElementById('recName').textContent,
        reg: document.getElementById('recReg').textContent,
        vat: document.getElementById('recVat').textContent,
        addr: document.getElementById('recAddr').textContent,
        iban: document.getElementById('recIban').textContent,
        bank: document.getElementById('recBank').textContent,
        code: document.getElementById('recCode').textContent,
        email: document.getElementById('recEmail').textContent,
        phone: document.getElementById('recPhone').textContent,
        notes: document.getElementById('recNotes').textContent,
      },
      products: Array.from(document.querySelectorAll('.product-row')).map(row => {
        const name = row.querySelector('input[type="text"]')?.value || '';
        const unit = row.querySelector('select')?.value || '';
        const qty = row.querySelector('input[type="number"]')?.value || '0';
        const price = row.querySelectorAll('input[type="number"]')[1]?.value || '0';
        const discount = row.querySelector('.discount-col input')?.value || '';
        return { name, unit, qty, price, discount };
      }),
      total: document.getElementById('grandTotal').textContent
    };

    // NosÅ«tÄ«t Wix lapai
    window.parent.postMessage({ action: 'saveInvoice', data: invoiceData }, '*');
  });

  function downloadPDF() {
  const element = document.getElementById("invoiceContainer"); // Å¡is ir tas elements kurÅ¡ satur visu rÄ“Ä·inu
  const opt = {
    margin:       0.5,
    filename:     'Rekins.pdf',
    image:        { type: 'jpeg', quality: 0.98 },
    html2canvas:  { scale: 2 },
    jsPDF:        { unit: 'in', format: 'a4', orientation: 'portrait' }
  };

  html2pdf().set(opt).from(element).save();
}

window.addEventListener('message', (event) => {
  if (event.data?.action === 'triggerPdfDownload') {
    downloadPDF(); // âœ… izsauc tavu jau eksistÄ“joÅ¡o lejupielÄdes funkciju
  }
});
</script>
</body>
</html>
